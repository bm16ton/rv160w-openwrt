From 1c027221c56f33e1b582600d1142540372ea401e Mon Sep 17 00:00:00 2001
From: "ding.wei" <ding.wei@nxp.com>
Date: Mon, 23 Oct 2017 15:32:17 +0800
Subject: [PATCH 2/2] CS3831296-SRRC-issue-2
Content-Type: text/plain; charset="utf-8"

---
 main/src/wl/clm/src/wlc_clm_data.c |   43 ++++++++++++++++++------------------
 1 file changed, 22 insertions(+), 21 deletions(-)
 mode change 100644 => 100755 main/src/wl/clm/src/wlc_clm_data.c

diff --git a/main/src/wl/clm/src/wlc_clm_data.c b/main/src/wl/clm/src/wlc_clm_data.c
old mode 100644
new mode 100755
index 1f4eb99..e4cb4ea
--- a/main/src/wl/clm/src/wlc_clm_data.c
+++ b/main/src/wl/clm/src/wlc_clm_data.c
@@ -1,7 +1,7 @@
 /** CLM data (BLOB)
  * This file was generated by ClmCompiler v1.39.1
  * From CLM v9.15.6 (Broadcom-0.0) data created by ClmImport: 1.39.2
- * ClmCompiler flags: --blob_format 18.0 --txbf --ccrev "IN/984 E0/798 CN/959 JP/936 US/868 RU/973  IN/985 E0/799  CN/960 JP/937 US/869 RU/972" --1024_qam --obfuscate "BRCM CLM v9.15.6 Confidential.xml" /tmp/tmpM7Goqe
+ * ClmCompiler flags: --blob_format 18.2 --txbf --ccrev "IN/984 E0/798 CN/959 JP/936 US/868 RU/973  IN/985 E0/799  CN/960 JP/937 US/869 RU/972" --1024_qam --obfuscate "BRCM CLM v9.15.6 Confidential.xml" /tmp/tmp7C8VPm
 
 
  * <<Broadcom-WL-IPTag/Proprietary:>>
@@ -26,7 +26,7 @@ extern const struct clm_data_registry clm_data; /* Forward declaration */
  * Base of all references, contains version information */
 const struct clm_data_header clm_header = {
     CLM_HEADER_TAG,      /* Magic word */
-    18, 0,               /* BLOB format version */
+    18, 2,               /* BLOB format version */
     "9.15.6", "1.39.1",  /* CLM version, compiler version */
     &clm_header,         /* Self reference */
     &clm_data,           /* Data registry */
@@ -34,8 +34,8 @@ const struct clm_data_header clm_header = {
     "Broadcom-0.0",      /* SW Apps version */
 };
 
-#if (18 > CLM_FORMAT_VERSION_MAJOR) || ((18 == CLM_FORMAT_VERSION_MAJOR) && (0 > CLM_FORMAT_VERSION_MINOR))
-    #error CLM data format version mismatch between tmpM7Goqe (this file) and wlc_clm_data.h (see CLM_FORMAT_VERSION_MAJOR and CLM_FORMAT_VERSION_MINOR macros in wlc_clm_data.h). This BLOB has format 18.0
+#if (18 > CLM_FORMAT_VERSION_MAJOR) || ((18 == CLM_FORMAT_VERSION_MAJOR) && (2 > CLM_FORMAT_VERSION_MINOR))
+    #error CLM data format version mismatch between tmp7C8VPm (this file) and wlc_clm_data.h (see CLM_FORMAT_VERSION_MAJOR and CLM_FORMAT_VERSION_MINOR macros in wlc_clm_data.h). This BLOB has format 18.2
 #endif
 
 /** Valid 20M channels of 2.4G band */
@@ -1857,30 +1857,31 @@ enum ccrevs {
 };
 
 /** Expands to region definition record */
-#define REGION(cc, rev, loc_2, loc_5, loc_HT_2, loc_HT_5, scr, flags)\
+#define REGION(cc, rev, loc_2, loc_5, loc_HT_2, loc_HT_5, scr, flags, flags2)\
     {{cc, (unsigned char)(0xFF & rev)},\
      {(unsigned char)(0xFF & LOCALE_2G_IDX_##loc_2),\
       (unsigned char)(0xFF & LOCALE_5G_IDX_##loc_5),\
       (unsigned char)(0xFF & LOCALE_2G_HT_IDX_##loc_HT_2),\
       (unsigned char)(0xFF & LOCALE_5G_HT_IDX_##loc_HT_5)},\
      {(unsigned char)(0xFF & ((rev) >> 8)),\
-      (unsigned char)(0xFF & (flags | scr))}}
+      (unsigned char)(0xFF & (flags | (scr & CLM_DATA_FLAG_REG_SC_RULES_MASK))),\
+      (unsigned char)(0xFF & ((scr >> CLM_DATA_FLAG_REG_SC_RULES_MASK_WIDTH))) | flags2}}
 
 /** Region definitions */
-static const clm_country_rev_definition_cd9_t country_definitions[] = {
+static const clm_country_rev_definition_cd10_t country_definitions[] = {
     /*      CC    rev      2.4        5            2.4 HT              5 HT  SubChan  flags */
-    REGION("CN",  959,   K_166,   1c_80,            Kn168,           1cn_81, SCR_1,   0), /* CN/959 */
-    REGION("CN",  960,   K_165,   1c_79,            Kn167,           1cn_80, SCR_1,   0), /* CN/960 */
-    REGION("E0",  798,   B_570,  3r_173,           Bn_377,          3rn_176, SCR_1,   CLM_DATA_FLAG_REG_EDCRS_EU), /* E0/798 */
-    REGION("E0",  799,   B_569,  3r_172,           Bn_376,          3rn_175, SCR_1,   CLM_DATA_FLAG_REG_TXBF | CLM_DATA_FLAG_REG_EDCRS_EU), /* E0/799 */
-    REGION("IN",  984,   C_144,   18_94,           Cn_131,           18n_87, SCR_1,   0), /* IN/984 */
-    REGION("IN",  985,   C_142,   18_93,           Cn_129,           18n_86, SCR_1,   0), /* IN/985 */
-    REGION("JP",  936,   C_145,  3j_134,           Cn_132,          3jn_143, SCR_1,   0), /* JP/936 */
-    REGION("JP",  937,   C_143,  3j_133,           Cn_130,          3jn_142, SCR_1,   0), /* JP/937 */
-    REGION("RU",  972,   B_574,   32_61,          Bn7_148,           32n_61, SCR_2,   0), /* RU/972 */
-    REGION("RU",  973,   B_573,   32_60,          Bn7_147,           32n_60, SCR_2,   CLM_DATA_FLAG_REG_EDCRS_EU), /* RU/973 */
-    REGION("US",  868, A13_186, 29a_147,          An13_64,         29an_129, SCR_3,   0), /* US/868 */
-    REGION("US",  869, A13_185, 29a_146,          An13_63,         29an_128, SCR_3,   CLM_DATA_FLAG_REG_TXBF), /* US/869 */
+    REGION("CN",  959,   K_166,   1c_80,            Kn168,           1cn_81, SCR_1,   0, CLM_DATA_FLAG_2_REG_CHSPRWAR2), /* CN/959 */
+    REGION("CN",  960,   K_165,   1c_79,            Kn167,           1cn_80, SCR_1,   0, CLM_DATA_FLAG_2_REG_CHSPRWAR2), /* CN/960 */
+    REGION("E0",  798,   B_570,  3r_173,           Bn_377,          3rn_176, SCR_1,   CLM_DATA_FLAG_REG_EDCRS_EU, 0), /* E0/798 */
+    REGION("E0",  799,   B_569,  3r_172,           Bn_376,          3rn_175, SCR_1,   CLM_DATA_FLAG_REG_TXBF | CLM_DATA_FLAG_REG_EDCRS_EU, 0), /* E0/799 */
+    REGION("IN",  984,   C_144,   18_94,           Cn_131,           18n_87, SCR_1,   0, 0), /* IN/984 */
+    REGION("IN",  985,   C_142,   18_93,           Cn_129,           18n_86, SCR_1,   0, 0), /* IN/985 */
+    REGION("JP",  936,   C_145,  3j_134,           Cn_132,          3jn_143, SCR_1,   0, 0), /* JP/936 */
+    REGION("JP",  937,   C_143,  3j_133,           Cn_130,          3jn_142, SCR_1,   0, 0), /* JP/937 */
+    REGION("RU",  972,   B_574,   32_61,          Bn7_148,           32n_61, SCR_2,   0, 0), /* RU/972 */
+    REGION("RU",  973,   B_573,   32_60,          Bn7_147,           32n_60, SCR_2,   CLM_DATA_FLAG_REG_EDCRS_EU, 0), /* RU/973 */
+    REGION("US",  868, A13_186, 29a_147,          An13_64,         29an_129, SCR_3,   0, 0), /* US/868 */
+    REGION("US",  869, A13_185, 29a_146,          An13_63,         29an_128, SCR_3,   CLM_DATA_FLAG_REG_TXBF, 0), /* US/869 */
 };
 
 /** Set of regions */
@@ -1914,7 +1915,7 @@ static const struct clm_aggregate_cc_set aggregate_cc_set = {
 
 
 /** BLOB ID */
-static const char user_string[] = "2017-09-11 09:46:49";
+static const char user_string[] = "2017-10-16 14:50:20";
 
 
 /** Registry of data structures stored in BLOB */
@@ -1929,7 +1930,7 @@ const struct clm_data_registry clm_data = {
     &country_definition_set,
     &advertised_cc_set,
     &aggregate_cc_set,
-    CLM_REGISTRY_FLAG_COUNTRY_10_FL | CLM_REGISTRY_FLAG_APPS_VERSION | CLM_REGISTRY_FLAG_SUB_CHAN_RULES | CLM_REGISTRY_FLAG_160MHZ | CLM_REGISTRY_FLAG_PER_BW_RS | CLM_REGISTRY_FLAG_PER_BAND_RATES | CLM_REGISTRY_FLAG_USER_STRING | (((int)WL_NUMRATES << CLM_REGISTRY_FLAG_NUM_RATES_SHIFT) & CLM_REGISTRY_FLAG_NUM_RATES_MASK) | CLM_REGISTRY_FLAG_HIGH_BW_COMBS | CLM_REGISTRY_FLAG_CD_REGIONS | CLM_REGISTRY_FLAG_CD_16_BIT_REV | (0 << CLM_REGISTRY_FLAG_CD_LOC_IDX_BYTES_SHIFT) | CLM_REGISTRY_FLAG_EXT_RATE_SETS | CLM_REGISTRY_FLAG_SUBCHAN_RULES_40,
+    CLM_REGISTRY_FLAG_COUNTRY_10_FL | CLM_REGISTRY_FLAG_APPS_VERSION | CLM_REGISTRY_FLAG_SUB_CHAN_RULES | CLM_REGISTRY_FLAG_160MHZ | CLM_REGISTRY_FLAG_PER_BW_RS | CLM_REGISTRY_FLAG_PER_BAND_RATES | CLM_REGISTRY_FLAG_USER_STRING | (((int)WL_NUMRATES << CLM_REGISTRY_FLAG_NUM_RATES_SHIFT) & CLM_REGISTRY_FLAG_NUM_RATES_MASK) | CLM_REGISTRY_FLAG_HIGH_BW_COMBS | CLM_REGISTRY_FLAG_CD_REGIONS | CLM_REGISTRY_FLAG_CD_16_BIT_REV | (0 << CLM_REGISTRY_FLAG_CD_LOC_IDX_BYTES_SHIFT) | CLM_REGISTRY_FLAG_EXT_RATE_SETS | CLM_REGISTRY_FLAG_SUBCHAN_RULES_40 | CLM_REGISTRY_FLAG_REGION_FLAG_2,
     &sub_chan_rules_set_5g_80m,
     0,
     channel_ranges_40m,
-- 
1.7.10

