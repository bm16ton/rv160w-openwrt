From 920fd4bf26ccefe22fb6d6987af01739285e1221 Mon Sep 17 00:00:00 2001
From: Ganesh Reddy <ganesh.reddy@nxp.com>
Date: Wed, 17 Feb 2021 22:03:57 +0530
Subject: [PATCH] LLDP memory leak vulnerability fix

Similar change adopted as per below references:
  https://github.com/lldpd/lldpd/commit/a8d3c90feca548fc0656d95b5d278713db86ff61
  https://mail.openvswitch.org/pipermail/ovs-announce/2021-January/000269.html

Signed-off-by: Ganesh Reddy <ganesh.reddy@nxp.com>
---
 src/lldp.c | 11 ++++++++++-
 1 file changed, 10 insertions(+), 1 deletion(-)

diff --git a/src/lldp.c b/src/lldp.c
index c15f4d5..a913079 100644
--- a/src/lldp.c
+++ b/src/lldp.c
@@ -1130,10 +1130,19 @@ lldp_decode(struct lldpd *cfg, char *frame, int s,
 			}
 			PEEK_BYTES(b, tlv_size);
 			if (tlv_type == LLDP_TLV_PORT_DESCR)
+			{
+				free(port->p_descr);
 				port->p_descr = b;
+			}
 			else if (tlv_type == LLDP_TLV_SYSTEM_NAME)
+			{
+				free(chassis->c_name);
 				chassis->c_name = b;
-			else chassis->c_descr = b;
+			}
+			else {
+				free(chassis->c_descr);
+				chassis->c_descr = b;
+			}
 			break;
 		case LLDP_TLV_SYSTEM_CAP:
 			CHECK_TLV_SIZE(4, "System capabilities");
-- 
2.7.4

